<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lucky Day | Web3 æƒ…ç»ªç–—æ„ˆ</title>
    
    <!-- 1. å¼•å…¥å¿…è¦çš„ CDN èµ„æº -->
    <!-- å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;500;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React å…¨å®¶æ¡¶ -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å›¾æ ‡åº“ -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 2. é…ç½® Tailwind ä¸»é¢˜ (è«å…°è¿ªè‰²ç³») -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        morandi: {
                            mist: "#E0E5DF", clay: "#E6DCCA", sage: "#BCE2D1",
                            haze: "#B0C4DE", dusty: "#D8BFD8", oat: "#F5DEB3", shell: "#FFF5EE"
                        },
                        nari: {
                            black: "#2D2D2D", silver: "#E5E7EB", sparkle: "#FCD34D"
                        }
                    },
                    fontFamily: {
                        serif: ['"Noto Serif SC"', 'serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'breathe': 'breathe 4s ease-in-out infinite',
                        'blob': 'blob 10s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        breathe: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '0.8' },
                            '50%': { transform: 'scale(1.05)', opacity: '1' },
                        },
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { margin: 0; overflow: hidden; -webkit-font-smoothing: antialiased; }
        /* æ¯›ç»ç’ƒå¡ç‰‡æ ·å¼ */
        .glass-card {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }
        /* Nari ç»˜å›¾è¾…åŠ© */
        .nari-head { border-radius: 40% 40% 45% 45%; }
        .nari-eyebrow { border-radius: 999px; }
        /* éšè—æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-morandi-mist text-gray-700 font-serif selection:bg-morandi-haze selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. æ ¸å¿ƒé€»è¾‘: äº”è¡Œèƒ½é‡ç®—æ³• ---
        const ELEMENT_CONFIG = {
            0: { type: 'Metal', color: 'bg-morandi-mist', hex: '#E0E5DF', vibe: 'ç§©åº', advice: 'ä»Šæ—¥ä¸–ç•Œçº·æ‰°ï¼Œä½†ä½ å†…å¿ƒå¦‚é‡‘å±èˆ¬æœ‰åºã€‚é€‚åˆåšå‡æ³•ï¼Œæ¸…ç†æ‚å¿µã€‚' },
            1: { type: 'Water', color: 'bg-morandi-haze', hex: '#B0C4DE', vibe: 'æµåŠ¨', advice: 'ä¸Šå–„è‹¥æ°´ã€‚ä»Šæ—¥é€‚åˆåœ¨å˜åŒ–ä¸­å¯»æ‰¾æœºä¼šï¼Œä¸è¦å¯¹æŠ—ï¼Œè¦åŒ…å®¹ã€‚' },
            2: { type: 'Wood', color: 'bg-morandi-sage', hex: '#BCE2D1', vibe: 'ç”Ÿé•¿', advice: 'ç”Ÿæœºå‹ƒå‹ƒçš„ä¸€å¤©ã€‚åƒæ ‘æœ¨ä¸€æ ·æ‰æ ¹å½“ä¸‹ï¼Œå‘ä¸Šä¼¸å±•ä½ çš„æƒ³æ³•ã€‚' },
            3: { type: 'Fire', color: 'bg-morandi-dusty', hex: '#D8BFD8', vibe: 'çƒ­æƒ…', advice: 'ä½ å°±æ˜¯å¾®å…‰ã€‚ä»Šæ—¥ä½ çš„ç›´è§‰æå‡†ï¼Œè·Ÿéšå†…å¿ƒçš„ç«èŠ±è¡ŒåŠ¨å§ã€‚' },
            4: { type: 'Earth', color: 'bg-morandi-oat', hex: '#F5DEB3', vibe: 'æ‰¿æ‰˜', advice: 'å¤§åœ°èˆ¬ç¨³é‡ã€‚åˆ«æ€¥ç€å†²åˆºï¼Œä»Šå¤©é€‚åˆå¤ç›˜å’Œç§¯ç´¯ã€‚' }
        };

        function calculateDestiny(dateStr) {
            // ç®—æ³•ï¼š(å‡ºç”Ÿå¹´+æœˆ+æ—¥ + ä»Šæ—¥æ—¥æœŸ) % 5 = ä»Šæ—¥å¯¹åº”å…ƒç´ 
            const birth = new Date(dateStr);
            const today = new Date();
            
            // å¦‚æœæ—¥æœŸæ— æ•ˆï¼Œè¿”å›é»˜è®¤
            if(isNaN(birth.getTime())) return ELEMENT_CONFIG[2];

            const seed = birth.getFullYear() + birth.getMonth() + birth.getDate() + today.getDate();
            const index = seed % 5;
            
            return {
                ...ELEMENT_CONFIG[index],
                luckyNumber: (seed % 9) + 1,
            };
        }

        // --- 2. è§†è§‰ç»„ä»¶: æµä½“èƒŒæ™¯ ---
        const LuckyBackground = ({ themeHex = '#E0E5DF', children }) => {
            return (
                <div className="relative w-full h-screen overflow-hidden bg-morandi-shell transition-colors duration-1000">
                    <div className="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] rounded-full mix-blend-multiply filter blur-[80px] opacity-70 animate-blob" style={{ backgroundColor: themeHex, animationDelay: '0s' }}></div>
                    <div className="absolute top-[20%] right-[-10%] w-[400px] h-[400px] rounded-full bg-morandi-oat mix-blend-multiply filter blur-[80px] opacity-60 animate-blob" style={{ animationDelay: '2s' }}></div>
                    <div className="absolute bottom-[-10%] left-[20%] w-[600px] h-[600px] rounded-full bg-morandi-mist mix-blend-multiply filter blur-[100px] opacity-50 animate-blob" style={{ animationDelay: '4s' }}></div>
                    <div className="relative z-10 w-full h-full flex flex-col">{children}</div>
                </div>
            );
        };

        // --- 3. IPç»„ä»¶: Nari (çº¯CSSç»˜åˆ¶) ---
        const NariAvatar = ({ state = 'meditating', size = 'md', onClick }) => {
            const sizeClass = size === 'lg' ? 'w-48 h-48' : (size === 'sm' ? 'w-16 h-16' : 'w-32 h-32');
            
            return (
                <div className={`${sizeClass} relative cursor-pointer group transition-transform duration-300 active:scale-95`} onClick={onClick}>
                    <div className="w-full h-full animate-float relative flex items-center justify-center">
                        {/* å¤´éƒ¨ */}
                        <div className="w-[80%] h-[80%] bg-nari-black nari-head shadow-xl relative overflow-hidden border-2 border-nari-silver/20 z-10">
                            {/* çœ‰æ¯› */}
                            <div className="absolute top-[25%] left-0 w-full flex justify-center gap-3 px-2">
                                <div className="w-[35%] h-3 bg-nari-silver nari-eyebrow transform rotate-12 shadow-sm"></div>
                                <div className="w-[35%] h-3 bg-nari-silver nari-eyebrow transform -rotate-12 shadow-sm"></div>
                            </div>
                            {/* çœ¼ç› */}
                            <div className="absolute top-[48%] left-0 w-full flex justify-center gap-6">
                                {state === 'meditating' ? (
                                    <><div className="w-4 h-1 bg-gray-600 rounded-full"></div><div className="w-4 h-1 bg-gray-600 rounded-full"></div></>
                                ) : (
                                    <><div className="w-3 h-3 bg-white rounded-full animate-pulse"></div><div className="w-3 h-3 bg-white rounded-full animate-pulse"></div></>
                                )}
                            </div>
                            {/* èƒ¡å­ */}
                            <div className="absolute bottom-[-10%] left-[10%] w-[80%] h-[45%] bg-nari-silver rounded-t-[30px]"></div>
                        </div>
                        {/* ç‰¹æ•ˆ */}
                        {state === 'meditating' && <div className="absolute inset-0 border-2 border-white/40 rounded-full animate-breathe opacity-50"></div>}
                        {state === 'happy' && <div className="absolute top-0 right-0 text-3xl animate-bounce">âœ¨</div>}
                    </div>
                </div>
            );
        };

        // --- 4. é¡µé¢è§†å›¾ç»„ä»¶ ---

        // View 1: é¦–é¡µ
        const HomeView = ({ onStart }) => {
            return (
                <div className="flex-1 flex flex-col items-center justify-center p-6 text-center gap-8 animate-fade-in">
                    <div>
                        <h1 className="text-5xl font-serif text-nari-black tracking-widest mb-2">Lucky Day</h1>
                        <p className="text-xs text-gray-500 uppercase tracking-[0.4em]">Web3 Spiritual Sanctuary</p>
                    </div>
                    
                    <div onClick={onStart}>
                        <NariAvatar state="meditating" size="lg" />
                    </div>

                    <button onClick={onStart} className="relative group mt-8">
                        <div className="absolute inset-0 bg-gradient-to-r from-morandi-sage to-morandi-haze rounded-full blur opacity-40 group-hover:opacity-60 transition-opacity duration-500"></div>
                        <div className="relative px-10 py-4 glass-card rounded-full text-gray-700 font-serif tracking-widest hover:scale-105 transition-transform duration-300">
                            Connect & Breathe
                        </div>
                    </button>
                    <p className="absolute bottom-10 text-[10px] text-gray-400">Powered by Nari & Ethereum</p>
                </div>
            );
        };

        // View 2: ç”Ÿæ—¥å½•å…¥é¡µ (æ–°å¢)
        const OnboardingView = ({ onComplete }) => {
            const [date, setDate] = useState('');

            const handleSubmit = () => {
                if (!date) return alert("è¯·å‘Šè¯‰ Nari ä½ çš„ç ´å£³æ—¥ ğŸ‚ ä»¥ä¾¿è¿æ¥èƒ½é‡");
                // æ¨¡æ‹Ÿä¸€ä¸ªåŠ è½½è¿‡ç¨‹
                setTimeout(() => onComplete(date), 500);
            };

            return (
                <div className="flex-1 flex flex-col items-center justify-center p-8 text-center animate-fade-in">
                    <div className="mb-6">
                        <NariAvatar state="happy" size="md" />
                    </div>
                    <h2 className="text-2xl font-serif text-gray-700 mb-2">å½“ä½ æ¥åˆ°è¿™ä¸ªæ˜Ÿçƒ...</h2>
                    <p className="text-xs text-gray-500 mb-8">Nari éœ€è¦è¿™ä¸ªæ—¶é—´åæ ‡æ¥è®¡ç®—ä»Šæ—¥èƒ½é‡</p>
                    
                    <div className="w-full max-w-xs relative mb-8">
                        <input 
                            type="date" 
                            onChange={(e) => setDate(e.target.value)}
                            className="w-full p-4 rounded-xl bg-white/40 border border-white/60 text-center text-gray-700 font-serif text-lg focus:outline-none focus:ring-2 focus:ring-morandi-haze shadow-inner"
                        />
                    </div>
                    
                    <button onClick={handleSubmit} className="w-full max-w-xs py-4 rounded-xl bg-nari-black text-white font-serif tracking-widest shadow-lg hover:scale-[1.02] transition-transform">
                        å¼€å§‹æµ‹ç®—
                    </button>
                </div>
            );
        };

        // View 3: è¿åŠ¿ç»“æœé¡µ
        const DailyView = ({ fortune, setView }) => {
            return (
                <div className="flex-1 flex flex-col items-center pt-10 pb-10 px-6 overflow-y-auto animate-fade-in">
                    {/* å¯¼èˆªæ  */}
                    <div className="w-full flex justify-between items-center max-w-md mb-6">
                        <button onClick={() => setView('home')} className="text-sm text-gray-500 font-serif hover:text-gray-800">â† Exit</button>
                        <button onClick={() => setView('resonance')} className="px-3 py-1 bg-white/40 rounded-full text-xs text-gray-600 font-serif hover:bg-white/60 transition shadow-sm">
                            Energy Sync âœ¨
                        </button>
                    </div>

                    <div className="mb-[-20px] z-20">
                        <NariAvatar state="happy" size="md" />
                    </div>

                    {/* å¡ç‰‡ä¸»ä½“ */}
                    <div className="w-full max-w-md glass-card rounded-[32px] p-8 flex flex-col items-center text-center z-10">
                        <div className="text-xs text-gray-400 mb-4 tracking-widest uppercase">
                            {new Date().toDateString()}
                        </div>

                        <h2 className="text-4xl font-serif text-nari-black mb-6 animate-pulse">
                            {fortune.vibe}
                        </h2>

                        <p className="text-gray-600 leading-relaxed font-serif text-sm mb-8 opacity-90">
                            â€œ{fortune.advice}â€
                        </p>

                        <div className="grid grid-cols-2 gap-4 w-full mb-6">
                            <div className="p-4 bg-white/50 rounded-2xl flex flex-col items-center">
                                <span className="text-[10px] text-gray-400 uppercase mb-1">Color</span>
                                <div className={`w-8 h-8 rounded-full ${fortune.color} border border-white/50 shadow-sm mb-1`}></div>
                                <span className="text-xs text-gray-500">è«å…°è¿ªè‰²</span>
                            </div>
                            <div className="p-4 bg-white/50 rounded-2xl flex flex-col items-center justify-center">
                                <span className="text-[10px] text-gray-400 uppercase mb-1">Number</span>
                                <span className="text-2xl font-serif text-gray-700">{fortune.luckyNumber}</span>
                            </div>
                        </div>

                        <button className="w-full py-3 rounded-xl bg-nari-black text-nari-silver font-sans text-sm tracking-wide shadow-lg hover:bg-gray-800 transition-colors">
                            Share My Lucky Day
                        </button>
                    </div>
                </div>
            );
        };

        // View 4: èƒ½é‡å…±é¸£é¡µ
        const ResonanceView = ({ setView }) => {
            const [step, setStep] = useState(0); 
            // 0: Input, 1: Fusing, 2: Result

            const startFusion = () => {
                setStep(1);
                setTimeout(() => setStep(2), 2500);
            };

            return (
                <div className="absolute inset-0 bg-white/95 z-50 flex flex-col items-center justify-center animate-fade-in">
                    <button onClick={() => setView('daily')} className="absolute top-8 right-8 text-2xl text-gray-400 font-serif">Ã—</button>

                    <div className="relative w-full h-[50vh] flex items-center justify-center">
                        {/* å·¦çƒ */}
                        <div className={`absolute w-32 h-32 rounded-full blur-2xl opacity-80 bg-morandi-haze transition-all duration-[2000ms] ease-in-out ${step >= 1 ? 'translate-x-0 scale-150' : '-translate-x-24'}`}></div>
                        {/* å³çƒ */}
                        <div className={`absolute w-32 h-32 rounded-full blur-2xl opacity-80 bg-morandi-oat transition-all duration-[2000ms] ease-in-out ${step >= 1 ? 'translate-x-0 scale-150' : 'translate-x-24'}`}></div>

                        {/* ç»“æœæ˜¾ç¤º */}
                        {step === 2 && (
                            <div className="z-20 text-center animate-fade-in flex flex-col items-center mt-32">
                                <div className="flex justify-center items-center mb-4">
                                     <NariAvatar state="happy" size="sm" />
                                     <div className="-ml-4 transform scale-x-[-1] opacity-80"><NariAvatar state="happy" size="sm" /></div>
                                </div>
                                <h2 className="text-3xl font-serif text-gray-700 mb-2">Soul Sync</h2>
                                <p className="text-gray-500 font-light text-sm max-w-xs mx-auto px-6">
                                    "åƒå¾®é£é‡åˆ°äº†äº‘æœµï¼Œ<br/>ä½ ä»¬çš„èƒ½é‡åœ¨ä»Šæ—¥è¾¾åˆ°äº†å®Œç¾çš„å¹³è¡¡ã€‚"
                                </p>
                                <div className="mt-4 px-4 py-1 rounded-full bg-morandi-sage/30 text-xs text-gray-600">
                                    Resonance Color: Celadon
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="absolute bottom-16 w-full px-8">
                        {step === 0 ? (
                            <div className="flex flex-col gap-4 animate-fade-in">
                                <p className="text-center text-xs text-gray-400 uppercase tracking-widest">Connect Energies</p>
                                <input type="text" placeholder="è¾“å…¥å¥½å‹åå­— / ENS" className="w-full p-4 rounded-xl bg-gray-100 text-center font-serif focus:outline-none focus:ring-1 focus:ring-morandi-haze" />
                                <button onClick={startFusion} className="w-full py-4 rounded-xl bg-nari-black text-white font-serif tracking-widest shadow-lg hover:scale-[1.02] transition-transform">
                                    å¼€å§‹å…±é¸£
                                </button>
                            </div>
                        ) : step === 2 ? (
                            <button onClick={() => setStep(0)} className="w-full py-4 rounded-xl border border-gray-300 text-gray-500 font-serif hover:bg-gray-50">
                                æµ‹ç®—å¦ä¸€ä½å¥½å‹
                            </button>
                        ) : null}
                    </div>
                </div>
            );
        };

        // --- 5. ä¸»ç¨‹åº ---
        const App = () => {
            const [view, setView] = useState('home'); 
            const [fortune, setFortune] = useState(null);

            // æµç¨‹é€»è¾‘
            const startFlow = () => setView('onboarding'); // é¦–é¡µ -> å»è¾“å…¥
            
            const handleBirthdaySubmit = (dateStr) => {
                const data = calculateDestiny(dateStr); // çœŸå®è®¡ç®—
                setFortune(data);
                setView('daily'); // è¾“å…¥ -> çœ‹ç»“æœ
            };

            return (
                <LuckyBackground themeHex={fortune ? fortune.hex : '#E0E5DF'}>
                    {view === 'home' && <HomeView onStart={startFlow} />}
                    {view === 'onboarding' && <OnboardingView onComplete={handleBirthdaySubmit} />}
                    {view === 'daily' && <DailyView fortune={fortune} setView={setView} />}
                    {view === 'resonance' && <ResonanceView setView={setView} />}
                </LuckyBackground>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    
    <script>
        // åˆå§‹åŒ–å›¾æ ‡
        lucide.createIcons();
    </script>
</body>
</html>
